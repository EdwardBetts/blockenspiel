<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Blockenspiel::Builder - Blockenspiel 0.5.0 Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Object
  
</div>

    <div id="includes-section" class="nav-section">
  <h3>Included Modules</h3>

  <ul class="link-list">
  
  
    <li><a class="include" href="DSL.html">Blockenspiel::DSL</a>
  
  
  </ul>
</div>

    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-i-add_method">#add_method</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Blockenspiel::Builder">
  <h1 id="class-Blockenspiel::Builder" class="class">
    class Blockenspiel::Builder
  </h1>

  <section class="description">
    
<h3 id="class-Blockenspiel::Builder-label-Dynamically+construct+a+target">Dynamically construct a target<span><a href="#class-Blockenspiel::Builder-label-Dynamically+construct+a+target">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>These methods are available in a block passed to Blockenspiel#invoke and
can be used to dynamically define what methods are available from a block.
See Blockenspiel#invoke for more information.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-add_method" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_method</span><span
            class="method-args">(name_, opts_={}, &block_)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-add_method-label-Declare+a+DSL+method.">Declare a <a href="DSL.html">DSL</a> method.<span><a href="#method-i-add_method-label-Declare+a+DSL+method.">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>This call creates a method that can be called from the <a
href="DSL.html">DSL</a> block. Provide a name for the method, a block
defining the method&#39;s implementation, and an optional hash of options.</p>

<p>By default, a method of the same name is also made available to
parameterless blocks. To change the name of the parameterless method,
provide its name as the value of the <code>:dsl_method</code> option. To
disable this method for parameterless blocks, set the
<code>:dsl_method</code> option to <code>false</code>.</p>

<p>The <code>:mixin</code> option is a deprecated alias for
<code>:dsl_method</code>.</p>

<h3 id="method-i-add_method-label-Warning+about+the+return+keyword">Warning about the <code>return</code> keyword<span><a href="#method-i-add_method-label-Warning+about+the+return+keyword">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Because you are implementing your method using a block, remember the
distinction between <code>Proc.new</code> and <code>lambda</code>. Invoking
<code>return</code> from the former does not return from the block, but
returns from the surrounding method scope. Since normal blocks passed to
methods are of the former type, be very careful about using the
<code>return</code> keyword:</p>

<pre class="ruby"><span class="ruby-identifier">add_method</span>(:<span class="ruby-identifier">foo</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">param</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;foo called with parameter &quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">param</span>.<span class="ruby-identifier">inspect</span>
  <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;a return value&quot;</span>   <span class="ruby-comment"># DOESN&#39;T WORK LIKE YOU EXPECT!</span>
<span class="ruby-keyword">end</span>
</pre>

<p>To return a value from the method you are creating, set the evaluation
value at the end of the block:</p>

<pre class="ruby"><span class="ruby-identifier">add_method</span>(:<span class="ruby-identifier">foo</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">param</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;foo called with parameter &quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">param</span>.<span class="ruby-identifier">inspect</span>
  <span class="ruby-string">&quot;a return value&quot;</span>    <span class="ruby-comment"># Returns from method foo</span>
<span class="ruby-keyword">end</span>
</pre>

<p>If you must use the <code>return</code> keyword, create your block as a
lambda as in this example:</p>

<pre class="ruby"><span class="ruby-identifier">code</span> = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">param</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;foo called with parameter &quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">param</span>.<span class="ruby-identifier">inspect</span>
  <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;a return value&quot;</span>   <span class="ruby-comment"># Returns from method foo</span>
<span class="ruby-keyword">end</span>
<span class="ruby-identifier">add_method</span>(:<span class="ruby-identifier">foo</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">code</span>)
</pre>

<h3 id="method-i-add_method-label-Accepting+a+block+argument">Accepting a block argument<span><a href="#method-i-add_method-label-Accepting+a+block+argument">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>If you want your method to take a block, you have several options depending
on your Ruby version. If you are running the standard Matz Ruby interpreter
(MRI) version 1.8.7 or later (including 1.9.x), or a compatible interpreter
such as JRuby 1.5 or later, you can use the standard “&amp;” block argument
notation to receive the block. Note that you must call the passed block
using the <code>call</code> method since Ruby doesn&#39;t support invoking
such a block with <code>yield</code>. For example, to create a method named
“foo” that takes one parameter and a block, do this:</p>

<pre class="ruby"><span class="ruby-identifier">add_method</span>(:<span class="ruby-identifier">foo</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">param</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;foo called with parameter &quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">param</span>.<span class="ruby-identifier">inspect</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;the block returned &quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span>.<span class="ruby-identifier">inspect</span>
<span class="ruby-keyword">end</span>
</pre>

<p>In your <a href="DSL.html">DSL</a>, you can then call:</p>

<pre class="ruby"><span class="ruby-identifier">foo</span>(<span class="ruby-string">&quot;hello&quot;</span>){ <span class="ruby-string">&quot;a value&quot;</span> }
</pre>

<p>If you are using MRI 1.8.6, or another Ruby interpreter that doesn&#39;t
fully support this syntax (such as JRuby versions older than 1.5), <a
href="../Blockenspiel.html">Blockenspiel</a> provides an alternative in the
form of the <code>:block</code> option. This option causes blocks provided
by the caller to be included in the normal parameter list to your method,
instead of as a block parameter. It can be set to <code>:first</code> or
<code>:last</code> to prepend or append, respectively, the block (as a
<code>Proc</code> object) to the parameter list. If the caller does not
include a block when calling your <a href="DSL.html">DSL</a> method, nil is
prepended/appended. For example:</p>

<pre class="ruby"><span class="ruby-identifier">add_method</span>(:<span class="ruby-identifier">foo</span>, :<span class="ruby-identifier">block</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">last</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">param</span>, <span class="ruby-identifier">block</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;foo called with parameter &quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">param</span>.<span class="ruby-identifier">inspect</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;the block returned &quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span>.<span class="ruby-identifier">inspect</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;no block passed&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>The <code>:receive_block</code> option is a deprecated alternative. Setting
<code>:receive_block =&gt; true</code> is currently equivalent to setting
<code>:block =&gt; :last</code>.</p>
          
          

          
          <div class="method-source-code" id="add_method-source">
            <pre><span class="ruby-comment"># File lib/blockenspiel/builder.rb, line 187</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_method</span>(<span class="ruby-identifier">name_</span>, <span class="ruby-identifier">opts_</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block_</span>)
  <span class="ruby-identifier">receive_block_</span> = <span class="ruby-identifier">opts_</span>[<span class="ruby-value">:receive_block</span>] <span class="ruby-operator">?</span> <span class="ruby-value">:last</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">opts_</span>[<span class="ruby-value">:block</span>]
  <span class="ruby-identifier">receive_block_</span> = <span class="ruby-value">:first</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">receive_block_</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">receive_block_</span> <span class="ruby-operator">!=</span> <span class="ruby-value">:last</span>
  <span class="ruby-ivar">@target_class</span>.<span class="ruby-identifier">_add_methodinfo</span>(<span class="ruby-identifier">name_</span>, <span class="ruby-identifier">block_</span>, <span class="ruby-identifier">receive_block_</span>)
  <span class="ruby-identifier">dsl_method_name_</span> = <span class="ruby-identifier">opts_</span>[<span class="ruby-value">:dsl_method</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">opts_</span>[<span class="ruby-value">:mixin</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">dsl_method_name_</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">dsl_method_name_</span> = <span class="ruby-identifier">name_</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">dsl_method_name_</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">dsl_method_name_</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
    <span class="ruby-ivar">@target_class</span>.<span class="ruby-identifier">dsl_method</span>(<span class="ruby-identifier">dsl_method_name_</span>, <span class="ruby-identifier">name_</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

